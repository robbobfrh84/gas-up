<!DOCTYPE html><html lang="en">
<head>
  <title> part1-basic-public-read-update </title>
  <meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="simpleLoader.css">
  <style> td { border: 1px solid; padding: 3px;} </style>
</head>
<body>
  <h1> Google Script API basic READ & UPDATE </h1>
  <em>...Get all data and add to page view count.</em> <br> <br>
  Included: <br>
  &bull; Google Script API <code>READ_all</code> method returns all google spreadheets' data <br>
  &bull; Each 'sheet' within the spreadsheet displayed in html <code>&#60;table&#62;</code> <br> <br>
  &star; See Console for object of sheets (option+command+j) <br>
  <hr>
  <div class="relative">
    <div class="sLoader" id='loader1'> <div></div><div></div><div></div> </div>
  </div>
  <div id='tables'></div>
</body>
<script>

var url = "https://script.google.com/macros/s/AKfycbzLv7D7mTNzozq1KmwYxWdTuFCvoD5qMZPuB0HS40owa335_TKv/exec?action=READ&arg=all"

window.onload = ()=>{
  _loader1 = true
  _get(url).then(payload => _build_sheets_tables(payload))
    .finally(() => _loader('off'))
}

_build_sheets_tables = (payload)=>{
  const data = JSON.parse(payload)
  console.log(" API: /exec?action=READ&arg=all endpoint returns payload: ", data);
  const tables = document.getElementById('tables')
  for (const sheet in data) {
    tables.innerHTML += `
      <h3>Sheet Name: <em>${sheet}</em></h3>
      <table id='dynamic-table-${sheet}'>
        <tr id='dynamic-headers-${sheet}'></tr>
      </table> <br>
    `
    const headers = document.getElementById("dynamic-headers-"+sheet)
    const table = document.getElementById("dynamic-table-"+sheet)
    for (const header in data[sheet][0]) {
      headers.innerHTML += `
        <th>${header}</th>
      `
    }
    data[sheet].map((row,ii)=>{
      table.innerHTML += `<tr id='row-${sheet}-${ii}'></tr>`
      const tdRow = document.getElementById('row-'+sheet+'-'+ii)
      for (val in row) {
        tdRow.innerHTML += `
         <td> ${row[val]} </td>
        `
      }
    })
  }
}

_get = (url)=>{
  return new Promise((res, rej) => {
    let xhr = new XMLHttpRequest();
    xhr.open('GET', url, true);
    xhr.onreadystatechange = function () {
      if (this.readyState == 4) {
        if (this.status == 200) {
          res(xhr.responseText)
        } else {
          rej(xhr)
        }
      }
    }
    xhr.send(null)
  })
}

var _loader1 = false
_loader = (direct_state_change)=>{
  if (direct_state_change) {
    if (direct_state_change === 'on') _loader1 = true
    if (direct_state_change === 'off') _loader1 = false
  } else {
    _loader1 = !_loader1
  }
  document.getElementById('loader1').style.display = _loader1 ? '' : 'none'
}

</script>
</html>
